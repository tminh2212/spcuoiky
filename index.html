<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sản phẩm cuối kỳ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Trang đăng nhập/đăng ký -->
    <div class="container" id="login-container">
        <h2>Đăng nhập / Đăng ký</h2>
        <form id="loginForm" autocomplete="off">
            <label for="email">Email:</label>
            <input type="email" id="email" required>
            <label for="password">Mật khẩu:</label>
            <input type="password" id="password" required>
            <button type="submit">Đăng nhập</button>
            <button type="button" id="registerBtn" style="margin-top:8px;background:#28a745;">Đăng ký</button>
        </form>
    </div>


  
    <script>
        // Đăng ký/Đăng nhập bằng localStorage
        function getUsers() {
            return JSON.parse(localStorage.getItem('users') || '{}');
        }
        function setUsers(users) {
            localStorage.setItem('users', JSON.stringify(users));
        }
        let currentUser = null;

        // Chuẩn hóa & kiểm tra Gmail
        function canonicalizeEmail(raw) {
            const e = raw.trim().toLowerCase();
            const [local, domain] = e.split('@');
            if (domain !== 'gmail.com') return e; // chỉ chuẩn hóa với gmail
            // bỏ phần sau dấu + và bỏ dấu chấm
            const pureLocal = (local.split('+')[0] || '').replace(/\./g, '');
            return `${pureLocal}@gmail.com`;
        }
        function isValidGmail(raw) {
            // 6–30 ký tự, chữ/số/._, không dấu +, không .., không . đầu/cuối, domain gmail.com
            const re = /^(?!.*\.\.)(?!.*\+)(?!\.)([a-zA-Z0-9](?:[._]?[a-zA-Z0-9]){5,29})(?<!\.)@gmail\.com$/;
            return re.test(raw.trim().toLowerCase());
        }

        // Xử lý đăng nhập: nếu id trùng với id vừa đăng ký thì chuyển sang trang tiếp theo
        document.getElementById('loginForm').onsubmit = function(e) {
            e.preventDefault();
            const emailVal = email.value.trim();
            const passVal = password.value.trim();
            const users = getUsers();
            // Kiểm tra nếu email đã đăng ký và mật khẩu đúng thì đăng nhập thành công
            if (users[emailVal] && users[emailVal] === passVal) {
                currentUser = emailVal;
                showFileManager(); // Chuyển sang trang quản lý file
            } else {
                alert('Sai tài khoản hoặc mật khẩu!');
            }
        };

        document.getElementById('registerBtn').onclick = function() {
            const emailVal = email.value.trim();
            const passVal = password.value.trim();
            if (!emailVal || !passVal) return alert('Nhập đủ thông tin!');
            const users = getUsers();
            if (users[emailVal]) return alert('Email đã tồn tại!');
            users[emailVal] = passVal;
            setUsers(users);
            alert('Đăng ký thành công!');
        };

        // Hiển thị trang quản lý file
        function showFileManager() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('file-manager').style.display = 'block';
            document.getElementById('stats-page').style.display = 'none';
            selectedFolderPath = ['root'];
            renderTree();
        }

        
    </script>
</body>
</html>