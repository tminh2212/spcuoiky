<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang quản trị</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>Trang quản trị</h1>
            <div class="header-actions">
                <a href="#" id="viewStats">Xem thống kê</a>
                <button id="themeToggleAdmin" class="theme-toggle">Chế độ sáng</button>
                <button id="logoutBtn" class="logout-btn">Đăng xuất</button>
            </div>
        </div>

        <div class="admin-content">
            <p class="welcome-text">Xin chào, admin!</p>

            <div class="main-content">
                <!-- Thêm tài khoản mới -->
                <div class="card">
                    <h2>Thêm tài khoản mới</h2>
                    <form id="addUserForm">
                        <label for="newUsername">Tên đăng nhập</label>
                        <input type="text" id="newUsername" placeholder="Nhập tên đăng nhập">
                        
                        <label for="newPassword">Mật khẩu</label>
                        <input type="password" id="newPassword" placeholder="Nhập mật khẩu">
                        
                        <label for="userRole">Vai trò</label>
                        <select id="userRole">
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                        
                        <button type="submit" class="btn-primary">Tạo tài khoản</button>
                        <div class="success-message" id="addSuccess"></div>
                    </form>
                </div>

                <!-- Danh sách tài khoản -->
                <div class="card">
                    <h2>Danh sách tài khoản</h2>
                    <input type="text" id="searchInput" placeholder="Tìm tài khoản...">
                    <table id="userTable">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Vai trò</th>
                                <th>Ngày tạo</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="userList">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Kiểm tra đăng nhập admin
        function checkAdminLogin() {
            const currentUser = localStorage.getItem('currentUser');
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            
            if (!currentUser || !users[currentUser] || users[currentUser].role !== 'admin') {
                alert('Bạn không có quyền truy cập!');
                window.location.href = 'index.html';
            }
        }

        checkAdminLogin();

        // Lấy danh sách user
        function getUsers() {
            return JSON.parse(localStorage.getItem('users') || '{}');
        }

        function setUsers(users) {
            localStorage.setItem('users', JSON.stringify(users));
        }

        // Hiển thị danh sách tài khoản
        function displayUsers(searchTerm = '') {
            const users = getUsers();
            const tbody = document.getElementById('userList');
            tbody.innerHTML = '';

            for (let username in users) {
                if (searchTerm && !username.toLowerCase().includes(searchTerm.toLowerCase())) {
                    continue;
                }

                const user = users[username];
                const tr = document.createElement('tr');
                const isCurrentAdmin = username === localStorage.getItem('currentUser');
                
                tr.innerHTML = `
                    <td>${username}</td>
                    <td><span class="badge ${user.role === 'admin' ? 'badge-admin' : 'badge-user'}">${user.role}</span></td>
                    <td>${user.createdAt || new Date().toLocaleString('vi-VN')}</td>
                    <td>
                        ${!isCurrentAdmin ? `<button class="btn-delete" onclick="deleteUser('${username}')">Xóa</button>` : '<span class="current-user">Đang đăng nhập</span>'}
                    </td>
                `;
                tbody.appendChild(tr);
            }
        }

        // Xóa tài khoản
        function deleteUser(username) {
            if (confirm(`Bạn có chắc muốn xóa tài khoản "${username}"?`)) {
                const users = getUsers();
                delete users[username];
                setUsers(users);
                displayUsers();
                showSuccess('Đã xóa tài khoản thành công!', 'addSuccess');
            }
        }

        // Hiển thị thông báo thành công
        function showSuccess(message, elementId) {
            const successDiv = document.getElementById(elementId);
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        // Thêm tài khoản mới
        document.getElementById('addUserForm').onsubmit = function(e) {
            e.preventDefault();
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value.trim();
            const role = document.getElementById('userRole').value;

            if (!username || !password) {
                alert('Vui lòng nhập đầy đủ thông tin!');
                return;
            }

            const users = getUsers();
            if (users[username]) {
                alert('Tên đăng nhập đã tồn tại!');
                return;
            }

            users[username] = {
                password: password,
                role: role,
                createdAt: new Date().toLocaleString('vi-VN')
            };
            setUsers(users);
            
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            displayUsers();
            showSuccess('Tạo tài khoản thành công!', 'addSuccess');
        };

        // Tìm kiếm
        document.getElementById('searchInput').addEventListener('input', function(e) {
            displayUsers(e.target.value);
        });

        // Đăng xuất
        document.getElementById('logoutBtn').onclick = function() {
            if (confirm('Bạn có chắc muốn đăng xuất?')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        };

        // Chế độ sáng/tối - giống trang index
        const themeToggle = document.getElementById('themeToggleAdmin');
        let isDarkMode = true;

        themeToggle.onclick = function() {
            isDarkMode = !isDarkMode;
            if (isDarkMode) {
                document.body.classList.remove('light-mode');
                themeToggle.textContent = 'Chế độ sáng';
            } else {
                document.body.classList.add('light-mode');
                themeToggle.textContent = 'Chế độ tối';
            }
        };

        // Hiển thị danh sách khi load trang
        displayUsers();
    </script>
</body>
</html>